AmCharts.translations["export"]||(AmCharts.translations["export"]={});AmCharts.translations["export"].en||(AmCharts.translations["export"].en={"fallback.save.text":"CTRL + C to copy the data into the clipboard.","fallback.save.image":"Rightclick -> Save picture as... to save the image.","capturing.delayed.menu.label":"{{duration}}","capturing.delayed.menu.title":"Click to cancel","menu.label.print":"Print","menu.label.undo":"Undo","menu.label.redo":"Redo","menu.label.cancel":"Cancel","menu.label.save.image":"Download as ...","menu.label.save.data":"Save as ...","menu.label.draw":"Annotate ...","menu.label.draw.change":"Change ...","menu.label.draw.add":"Add ...","menu.label.draw.shapes":"Shape ...","menu.label.draw.colors":"Color ...","menu.label.draw.widths":"Size ...","menu.label.draw.opacities":"Opacity ...","menu.label.draw.text":"Text","menu.label.draw.modes":"Mode ...","menu.label.draw.modes.pencil":"Pencil","menu.label.draw.modes.line":"Line","menu.label.draw.modes.arrow":"Arrow","label.saved.from":"Saved from: "}),function(){AmCharts["export"]=function(n,t){var i={name:"export",version:"1.4.33",libs:{async:!0,autoLoad:!0,reload:!1,resources:["fabric.js/fabric.min.js","FileSaver.js/FileSaver.min.js","jszip/jszip.min.js","xlsx/xlsx.min.js",{"pdfmake/pdfmake.min.js":["pdfmake/vfs_fonts.js"]}],namespaces:{"pdfmake.js":"pdfMake","jszip.js":"JSZip","xlsx.js":"XLSX","fabric.js":"fabric","FileSaver.js":"saveAs"},loadTimeout:1e4},config:{},setup:{chart:n,hasBlob:!1,wrapper:!1,isIE:!!window.document.documentMode,IEversion:window.document.documentMode},drawing:{enabled:!1,undos:[],redos:[],buffer:{position:{x1:0,y1:0,x2:0,y2:0,xD:0,yD:0}},handler:{undo:function(n,t){var r=i.drawing.undos.pop(),u;r&&(r.selectable=!0,i.drawing.redos.push(r),r.action=="added"&&i.setup.fabric.remove(r.target),u=JSON.parse(r.state),r.target.set(u),r.target instanceof fabric.Group&&i.drawing.handler.change({color:u.cfg.color,width:u.cfg.width,opacity:u.cfg.opacity},!0,r.target),i.setup.fabric.renderAll(),r.state!=r.target.recentState||t||i.drawing.handler.undo(r,!0))},redo:function(){var n=i.drawing.redos.pop(),t;n&&(n.selectable=!0,i.drawing.undos.push(n),n.action=="added"&&i.setup.fabric.add(n.target),t=JSON.parse(n.state),n.target.recentState=n.state,n.target.set(t),n.target instanceof fabric.Group&&i.drawing.handler.change({color:t.cfg.color,width:t.cfg.width,opacity:t.cfg.opacity},!0,n.target),i.setup.fabric.renderAll(),n.action=="addified"&&i.drawing.handler.redo())},done:function(){i.drawing.enabled=!1;i.drawing.buffer.enabled=!1;i.drawing.undos=[];i.drawing.redos=[];i.createMenu(i.config.menu);i.setup.fabric.deactivateAll();i.setup.wrapper&&(i.setup.chart.containerDiv.removeChild(i.setup.wrapper),i.setup.wrapper=!1)},add:function(n){var t=i.deepMerge({top:i.setup.fabric.height/2,left:i.setup.fabric.width/2},n||{}),r=t.url.indexOf(".svg")!=-1?fabric.loadSVGFromURL:fabric.Image.fromURL;r(t.url,function(n,r){var u=r!==undefined?fabric.util.groupSVGElements(n,r):n,f=!1;(u.height>i.setup.fabric.height||u.width>i.setup.fabric.width)&&(f=i.setup.fabric.height/2/u.height);t.top>i.setup.fabric.height&&(t.top=i.setup.fabric.height/2);t.left>i.setup.fabric.width&&(t.left=i.setup.fabric.width/2);u.set({originX:"center",originY:"center",top:t.top,left:t.left,width:f?u.width*f:u.width,height:f?u.height*f:u.height,fill:i.drawing.color});i.setup.fabric.add(u)})},change:function(n,t,r){var u=i.deepMerge({},n||{}),s,f,h,o=r||i.drawing.buffer.target,e=o?o._objects?o._objects:[o]:null;if(u.mode&&(i.drawing.mode=u.mode),u.width&&(i.drawing.width=u.width,i.drawing.fontSize=u.width*3),u.fontSize&&(i.drawing.fontSize=u.fontSize),u.color&&(i.drawing.color=u.color),u.opacity&&(i.drawing.opacity=u.opacity),h=i.getRGBA(i.drawing.color),h.pop(),h.push(i.drawing.opacity),i.drawing.color="rgba("+h.join()+")",i.setup.fabric.freeDrawingBrush.color=i.drawing.color,i.setup.fabric.freeDrawingBrush.width=i.drawing.width,o){for(s=JSON.parse(o.recentState).cfg,s&&(u.color=u.color||s.color,u.width=u.width||s.width,u.opacity=u.opacity||s.opacity,u.fontSize=u.fontSize||u.width*3,h=i.getRGBA(u.color),h.pop(),h.push(u.opacity),u.color="rgba("+h.join()+")"),f=0;f<e.length;f++)e[f]instanceof fabric.Text||e[f]instanceof fabric.PathGroup||e[f]instanceof fabric.Triangle?((u.color||u.opacity)&&e[f].set({fill:u.color}),u.fontSize&&e[f].set({fontSize:u.fontSize})):(e[f]instanceof fabric.Path||e[f]instanceof fabric.Line)&&(o instanceof fabric.Group?(u.color||u.opacity)&&e[f].set({stroke:u.color}):((u.color||u.opacity)&&e[f].set({stroke:u.color}),u.width&&e[f].set({strokeWidth:u.width})));t||(s=JSON.stringify(i.deepMerge(o.saveState().originalState,{cfg:{color:u.color,width:u.width,opacity:u.opacity}})),o.recentState=s,i.drawing.redos=[],i.drawing.undos.push({action:"modified",target:o,state:s}));i.setup.fabric.renderAll()}},text:function(n){var r=i.deepMerge({text:i.i18l("menu.label.draw.text"),top:i.setup.fabric.height/2,left:i.setup.fabric.width/2,fontSize:i.drawing.fontSize,fontFamily:i.setup.chart.fontFamily||"Verdana",fill:i.drawing.color},n||{}),t;return r.click=function(){},t=new fabric.IText(r.text,r),i.setup.fabric.add(t),i.setup.fabric.setActiveObject(t),t.selectAll(),t.enterEditing(),t},line:function(n){var t=i.deepMerge({x1:i.setup.fabric.width/2-i.setup.fabric.width/10,x2:i.setup.fabric.width/2+i.setup.fabric.width/10,y1:i.setup.fabric.height/2,y2:i.setup.fabric.height/2,angle:90,strokeLineCap:i.drawing.lineCap,arrow:i.drawing.arrow,color:i.drawing.color,width:i.drawing.width,group:[]},n||{}),r,s,f,e,o=new fabric.Line([t.x1,t.y1,t.x2,t.y2],{stroke:t.color,strokeWidth:t.width,strokeLineCap:t.strokeLineCap}),u;if(t.group.push(o),t.arrow&&(t.angle=t.angle?t.angle:i.getAngle(t.x1,t.y1,t.x2,t.y2),t.arrow=="start"?(f=t.y1+t.width/2,e=t.x1+t.width/2):t.arrow=="middle"?(f=t.y2+t.width/2-(t.y2-t.y1)/2,e=t.x2+t.width/2-(t.x2-t.x1)/2):(f=t.y2+t.width/2,e=t.x2+t.width/2),s=new fabric.Triangle({top:f,left:e,fill:t.color,height:t.width*7,width:t.width*7,angle:t.angle,originX:"center",originY:"bottom"}),t.group.push(s)),t.action!="config")return t.arrow?(u=new fabric.Group(t.group),u.set({cfg:t,fill:t.color,action:t.action,selectable:!0,known:t.action=="change"}),t.action=="change"&&i.setup.fabric.setActiveObject(u),i.setup.fabric.add(u),u):(i.setup.fabric.add(o),o);for(r=0;r<t.group.length;r++)t.group[r].noUndo=!0,i.setup.fabric.add(t.group[r]);return t}}},defaults:{position:"top-right",fileName:"amCharts",action:"download",overflow:!0,path:(n.path||"")+"plugins/export/",formats:{JPG:{mimeType:"image/jpg",extension:"jpg",capture:!0},PNG:{mimeType:"image/png",extension:"png",capture:!0},SVG:{mimeType:"text/xml",extension:"svg",capture:!0},PDF:{mimeType:"application/pdf",extension:"pdf",capture:!0},CSV:{mimeType:"text/plain",extension:"csv"},JSON:{mimeType:"text/plain",extension:"json"},XLSX:{mimeType:"application/octet-stream",extension:"xlsx"}},fabric:{backgroundColor:"#FFFFFF",removeImages:!0,forceRemoveImages:!1,selection:!1,loadTimeout:5e3,drawing:{enabled:!0,arrow:"end",lineCap:"butt",mode:"pencil",modes:["pencil","line","arrow"],color:"#000000",colors:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF"],shapes:["11.svg","14.svg","16.svg","17.svg","20.svg","27.svg"],width:1,fontSize:11,widths:[1,5,10,15],opacity:1,opacities:[1,.8,.6,.4,.2],menu:undefined,autoClose:!0},border:{fill:"",fillOpacity:0,stroke:"#000000",strokeWidth:1,strokeOpacity:1}},pdfMake:{images:{},pageOrientation:"portrait",pageMargins:40,pageOrigin:!0,pageSize:"A4",pageSizes:{"4A0":[4767.87,6740.79],"2A0":[3370.39,4767.87],A0:[2383.94,3370.39],A1:[1683.78,2383.94],A2:[1190.55,1683.78],A3:[841.89,1190.55],A4:[595.28,841.89],A5:[419.53,595.28],A6:[297.64,419.53],A7:[209.76,297.64],A8:[147.4,209.76],A9:[104.88,147.4],A10:[73.7,104.88],B0:[2834.65,4008.19],B1:[2004.09,2834.65],B2:[1417.32,2004.09],B3:[1000.63,1417.32],B4:[708.66,1000.63],B5:[498.9,708.66],B6:[354.33,498.9],B7:[249.45,354.33],B8:[175.75,249.45],B9:[124.72,175.75],B10:[87.87,124.72],C0:[2599.37,3676.54],C1:[1836.85,2599.37],C2:[1298.27,1836.85],C3:[918.43,1298.27],C4:[649.13,918.43],C5:[459.21,649.13],C6:[323.15,459.21],C7:[229.61,323.15],C8:[161.57,229.61],C9:[113.39,161.57],C10:[79.37,113.39],RA0:[2437.8,3458.27],RA1:[1729.13,2437.8],RA2:[1218.9,1729.13],RA3:[864.57,1218.9],RA4:[609.45,864.57],SRA0:[2551.18,3628.35],SRA1:[1814.17,2551.18],SRA2:[1275.59,1814.17],SRA3:[907.09,1275.59],SRA4:[637.8,907.09],EXECUTIVE:[521.86,756],FOLIO:[612,936],LEGAL:[612,1008],LETTER:[612,792],TABLOID:[792,1224]}},menu:undefined,divId:null,menuReviver:null,menuWalker:null,fallback:!0,keyListener:!0,fileListener:!0},i18l:function(n,t){var r=t?langugage:i.setup.chart.language?i.setup.chart.language:"en",u=AmCharts.translations[i.name][r]||AmCharts.translations[i.name].en;return u[n]||n},download:function(n,t,r){var o;if(window.saveAs&&i.setup.hasBlob)o=i.toBlob({data:n,type:t},function(n){saveAs(n,r)});else if(i.config.fallback&&t=="text/plain"){var u=document.createElement("div"),f=document.createElement("div"),e=document.createElement("textarea");f.innerHTML=i.i18l("fallback.save.text");u.appendChild(f);u.appendChild(e);f.setAttribute("class","amcharts-export-fallback-message");u.setAttribute("class","amcharts-export-fallback");i.setup.chart.containerDiv.appendChild(u);e.setAttribute("readonly","");e.value=n;e.focus();e.select();i.createMenu([{"class":"export-main export-close",label:"Done",click:function(){i.createMenu(i.config.menu);i.setup.chart.containerDiv.removeChild(u)}}])}else if(i.config.fallback&&t.split("/")[0]=="image"){var u=document.createElement("div"),f=document.createElement("div"),s=i.toImage({data:n});f.innerHTML=i.i18l("fallback.save.image");u.appendChild(f);u.appendChild(s);f.setAttribute("class","amcharts-export-fallback-message");u.setAttribute("class","amcharts-export-fallback");i.setup.chart.containerDiv.appendChild(u);i.createMenu([{"class":"export-main export-close",label:"Done",click:function(){i.createMenu(i.config.menu);i.setup.chart.containerDiv.removeChild(u)}}])}else throw new Error("Unable to create file. Ensure saveAs (FileSaver.js) is supported.");return n},loadResource:function(n,t){var r,o,u,f,e,c,s=n.indexOf("//")!=-1?n:[i.libs.path,n].join(""),h=function(){if(t)for(r=0;r<t.length;r++)i.loadResource(t[r])};for(n.indexOf(".js")!=-1?(u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("src",s),i.libs.async&&u.setAttribute("async","")):n.indexOf(".css")!=-1&&(u=document.createElement("link"),u.setAttribute("type","text/css"),u.setAttribute("rel","stylesheet"),u.setAttribute("href",s)),r=0;r<document.head.childNodes.length;r++)if(f=document.head.childNodes[r],e=f?f.src||f.href:!1,c=f?f.tagName:!1,f&&e&&e.indexOf(n)!=-1){i.libs.reload&&document.head.removeChild(f);o=!0;break}for(r in i.libs.namespaces){var l=i.libs.namespaces[r],e=n.toLowerCase(),f=r.toLowerCase();if(e.indexOf(f)!=-1&&window[l]!==undefined){o=!0;break}}(!o||i.libs.reload)&&(u.addEventListener("load",h),document.head.appendChild(u),i.listenersToRemove||(i.listenersToRemove=[]),i.listenersToRemove.push({node:u,method:h,event:"load"}))},loadDependencies:function(){var n,t;if(i.libs.autoLoad)for(n=0;n<i.libs.resources.length;n++)if(i.libs.resources[n]instanceof Object)for(t in i.libs.resources[n])i.loadResource(t,i.libs.resources[n][t]);else i.loadResource(i.libs.resources[n])},pxToNumber:function(n,t){return!n&&t?undefined:Number(String(n).replace("px",""))||0},numberToPx:function(n){return String(n)+"px"},deepMerge:function(n,t,r){var f,u,e=t instanceof Array?"array":"object";for(f in t)e=="array"&&isNaN(f)||(u=t[f],(n[f]==undefined||r)&&(u instanceof Array?n[f]=[]:u instanceof Function?n[f]=function(){}:u instanceof Date?n[f]=new Date:u instanceof Object?n[f]={}:u instanceof Number?n[f]=new Number:u instanceof String&&(n[f]=new String)),!(n instanceof Object||n instanceof Array)||!(u instanceof Object||u instanceof Array)||u instanceof Function||u instanceof Date||i.isElement(u)||f=="chart"?n instanceof Array&&!r?n.push(u):n[f]=u:i.deepMerge(n[f],u,r));return n},isElement:function(n){return n instanceof Object&&n&&n.nodeType===1},isHashbanged:function(n){var t=String(n).replace(/\"/g,"");return t.slice(0,3)=="url"?t.slice(t.indexOf("#")+1,t.length-1):!1},isPressed:function(n){return n.type=="mousemove"&&n.which===1||(i.drawing.buffer.isPressed=n.type=="touchmove"||n.buttons===1||n.button===1||n.which===1?!0:!1),i.drawing.buffer.isPressed},removeImage:function(n){return n&&(i.config.fabric.forceRemoveImages||i.config.fabric.removeImages&&i.isTainted(n)||i.setup.isIE&&(i.setup.IEversion==10||i.setup.IEversion==11)&&n.toLowerCase().indexOf(".svg")!=-1)?!0:!1},isTainted:function(n){var t=String(window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));return n&&(t.indexOf(":\\")!=-1||n.indexOf(":\\")!=-1||t.indexOf("file://")!=-1||n.indexOf("file://")!=-1||n.indexOf("//")!=-1&&n.indexOf(t.replace(/.*:/,""))==-1)?!0:!1},isSupported:function(){return i.config.enabled?i.setup.isIE&&i.setup.IEversion<=9&&(!Array.prototype.indexOf||!document.head||i.config.fallback===!1)?!1:!0:!1},getAngle:function(n,t,i,r){var f=i-n,u=r-t,e;return e=f==0?u==0?0:u>0?Math.PI/2:Math.PI*3/2:u==0?f>0?0:Math.PI:f<0?Math.atan(u/f)+Math.PI:u<0?Math.atan(u/f)+2*Math.PI:Math.atan(u/f),e*180/Math.PI},gatherAttribute:function(n,t,r,u){var f,u=u?u:0,r=r?r:3;return n&&(f=n.getAttribute(t),!f&&u<r)?i.gatherAttribute(n.parentNode,t,r,u+1):f},gatherClassName:function(n,t,r,u){var f,u=u?u:0,r=r?r:3;if(i.isElement(n)){if(f=(n.getAttribute("class")||"").split(" ").indexOf(t)!=-1,!f&&u<r)return i.gatherClassName(n.parentNode,t,r,u+1);f&&(f=n)}return f},gatherElements:function(n,t,r){for(var f,u,h,l,e,o,s=0;s<n.children.length;s++)if(u=n.children[s],u.tagName=="clipPath"){for(h={},l=fabric.parseTransformAttribute(i.gatherAttribute(u,"transform")),f=0;f<u.childNodes.length;f++)u.childNodes[f].setAttribute("fill","transparent"),h={x:i.pxToNumber(u.childNodes[f].getAttribute("x")),y:i.pxToNumber(u.childNodes[f].getAttribute("y")),width:i.pxToNumber(u.childNodes[f].getAttribute("width")),height:i.pxToNumber(u.childNodes[f].getAttribute("height"))};n.clippings[u.id]={svg:u,bbox:h,transform:l}}else if(u.tagName=="pattern"){for(e={node:u,source:u.getAttribute("xlink:href"),width:Number(u.getAttribute("width")),height:Number(u.getAttribute("height")),repeat:"repeat",offsetX:0,offsetY:0},f=0;f<u.childNodes.length;f++)u.childNodes[f].tagName=="rect"?e.fill=u.childNodes[f].getAttribute("fill"):u.childNodes[f].tagName=="image"&&(o=fabric.parseAttributes(u.childNodes[f],fabric.SHARED_ATTRIBUTES),o.transformMatrix&&(e.offsetX=o.transformMatrix[4],e.offsetY=o.transformMatrix[5]));i.removeImage(e.source)?n.patterns[u.id]=e.fill?e.fill:"transparent":n.patterns[e.node.id]=e}else if(u.tagName=="image")r.included++,fabric.Image.fromURL(u.getAttribute("xlink:href"),function(){r.loaded++});else for(o=["fill","stroke"],f=0;f<o.length;f++){var c=o[f],a=u.getAttribute(c),v=i.getRGBA(a);a&&!v&&(u.setAttribute(c,"none"),u.setAttribute(c+"-opacity","0"))}return n},getRGBA:function(n,t){return n!="none"&&n!="transparent"&&!i.isHashbanged(n)&&(n=new fabric.Color(n),n._source)?t?n:n.getSource():!1},gatherPosition:function(n,t){var r=i.drawing.buffer.position,f=fabric.util.invertTransform(i.setup.fabric.viewportTransform),u;return n.type=="touchmove"&&("touches"in n?n=n.touches[0]:"changedTouches"in n&&(n=n.changedTouches[0])),u=fabric.util.transformPoint(i.setup.fabric.getPointer(n,!0),f),t==1&&(r.x1=u.x,r.y1=u.y),r.x2=u.x,r.y2=u.y,r.xD=r.x1-r.x2<0?(r.x1-r.x2)*-1:r.x1-r.x2,r.yD=r.y1-r.y2<0?(r.y1-r.y2)*-1:r.y1-r.y2,r},modifyFabric:function(){fabric.ElementsParser.prototype.resolveGradient=function(n,t){var i=n.get(t),r;/^url\(/.test(i)&&(r=i.slice(i.indexOf("#")+1,i.length-1),fabric.gradientDefs[this.svgUid][r]&&n.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][r],n)))};fabric.Text.fromElement=function(n,t){var u,o,r,e,i,f;if(!n)return null;if(u=fabric.parseAttributes(n,fabric.Text.ATTRIBUTE_NAMES),t=fabric.util.object.extend(t?fabric.util.object.clone(t):{},u),t.top=t.top||0,t.left=t.left||0,"dx"in u&&(t.left+=u.dx),"dy"in u&&(t.top+=u.dy),"fontSize"in t||(t.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE),t.originX||(t.originX="left"),o="",r=[],"textContent"in n)if(n.childNodes)for(e=0;e<n.childNodes.length;e++)r.push(n.childNodes[e].textContent);else r.push(n.textContent);else"firstChild"in n&&n.firstChild!==null&&"data"in n.firstChild&&n.firstChild.data!==null&&r.push(n.firstChild.data);return o=r.join("\n"),i=new fabric.Text(o,t),f=0,i.originX==="left"&&(f=i.getWidth()/2),i.originX==="right"&&(f=-i.getWidth()/2),r.length>1?i.set({left:i.getLeft()+f,top:i.getTop()+i.fontSize*(r.length-1)*(.18+i._fontSizeFraction),textAlign:t.originX,lineHeight:r.length>1?.965:1.16}):i.set({left:i.getLeft()+f,top:i.getTop()-i.getHeight()/2+i.fontSize*(.18+i._fontSizeFraction)}),i}},capture:function(n,t){var e,f=i.deepMerge(i.deepMerge({},i.config.fabric),n||{}),h=[],u={x:0,y:0,pX:0,pY:0,width:i.setup.chart.divRealWidth,height:i.setup.chart.divRealHeight},c={loaded:0,included:0},l,r,o;for(i.modifyFabric(),i.handleCallback(f.beforeCapture,f),l=i.setup.chart.containerDiv.getElementsByTagName("svg"),e=0;e<l.length;e++)r={svg:l[e],parent:l[e].parentNode,children:l[e].getElementsByTagName("*"),offset:{x:0,y:0},patterns:{},clippings:{}},r=i.gatherElements(r,f,c),h.push(r);i.config.legend&&i.setup.chart.legend&&i.setup.chart.legend.divId&&(r={svg:i.setup.chart.legend.container.container,parent:i.setup.chart.legend.container.container.parentNode,children:i.setup.chart.legend.container.container.getElementsByTagName("*"),offset:{x:0,y:0},legend:{type:["top","left"].indexOf(i.config.legend.position)!=-1?"unshift":"push",position:i.config.legend.position,width:i.config.legend.width?i.config.legend.width:i.setup.chart.legend.container.width,height:i.config.legend.height?i.config.legend.height:i.setup.chart.legend.container.height},patterns:{},clippings:{}},["left","right"].indexOf(r.legend.position)!=-1?(u.width+=r.legend.width,u.height=r.legend.height>u.height?r.legend.height:u.height):["top","bottom"].indexOf(r.legend.position)!=-1&&(u.height+=r.legend.height),r=i.gatherElements(r,f,c),h[r.legend.type](r));i.drawing.enabled=f.drawing.enabled=f.action=="draw";i.drawing.buffer.enabled=i.drawing.enabled;i.setup.wrapper=document.createElement("div");i.setup.wrapper.setAttribute("class",i.setup.chart.classNamePrefix+"-export-canvas");i.setup.chart.containerDiv.appendChild(i.setup.wrapper);i.setup.chart.type=="stock"&&(o={top:0,right:0,bottom:0,left:0},i.setup.chart.leftContainer&&(u.width-=i.setup.chart.leftContainer.offsetWidth,o.left=i.setup.chart.leftContainer.offsetWidth+i.setup.chart.panelsSettings.panelSpacing*2),i.setup.chart.rightContainer&&(u.width-=i.setup.chart.rightContainer.offsetWidth,o.right=i.setup.chart.rightContainer.offsetWidth+i.setup.chart.panelsSettings.panelSpacing*2),i.setup.chart.periodSelector&&["top","bottom"].indexOf(i.setup.chart.periodSelector.position)!=-1&&(u.height-=i.setup.chart.periodSelector.offsetHeight+i.setup.chart.panelsSettings.panelSpacing,o[i.setup.chart.periodSelector.position]+=i.setup.chart.periodSelector.offsetHeight+i.setup.chart.panelsSettings.panelSpacing),i.setup.chart.dataSetSelector&&["top","bottom"].indexOf(i.setup.chart.dataSetSelector.position)!=-1&&(u.height-=i.setup.chart.dataSetSelector.offsetHeight,o[i.setup.chart.dataSetSelector.position]+=i.setup.chart.dataSetSelector.offsetHeight),i.setup.wrapper.style.paddingTop=i.numberToPx(o.top),i.setup.wrapper.style.paddingRight=i.numberToPx(o.right),i.setup.wrapper.style.paddingBottom=i.numberToPx(o.bottom),i.setup.wrapper.style.paddingLeft=i.numberToPx(o.left));i.setup.canvas=document.createElement("canvas");i.setup.wrapper.appendChild(i.setup.canvas);i.setup.fabric=new fabric.Canvas(i.setup.canvas,i.deepMerge({width:u.width,height:u.height,isDrawingMode:!0},f));i.deepMerge(i.setup.fabric,f);i.deepMerge(i.setup.fabric.freeDrawingBrush,f.drawing);i.deepMerge(i.drawing,f.drawing);i.drawing.handler.change(f.drawing);i.setup.fabric.on("mouse:down",function(n){var t=i.gatherPosition(n.e,1);i.drawing.buffer.pressedTS=Number(new Date);i.isPressed(n.e)});i.setup.fabric.on("mouse:move",function(n){var r=i.gatherPosition(n.e,2),u,f,o,t;if(i.isPressed(n.e),i.drawing.buffer.isPressed&&!i.drawing.buffer.line&&!i.drawing.buffer.isSelected&&i.drawing.mode!="pencil"&&(r.xD>5||r.xD>5)&&(i.drawing.buffer.hasLine=!0,i.setup.fabric.isDrawingMode=!1,i.setup.fabric._onMouseUpInDrawingMode(n),i.drawing.buffer.line=i.drawing.handler.line({x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,arrow:i.drawing.mode=="line"?!1:i.drawing.arrow,action:"config"})),i.drawing.buffer.line){for(t=i.drawing.buffer.line,t.x2=r.x2,t.y2=r.y2,e=0;e<t.group.length;e++)u=t.group[e],u instanceof fabric.Line?u.set({x2:t.x2,y2:t.y2}):u instanceof fabric.Triangle&&(t.angle=i.getAngle(t.x1,t.y1,t.x2,t.y2)+90,t.arrow=="start"?(f=t.y1+t.width/2,o=t.x1+t.width/2):t.arrow=="middle"?(f=t.y2+t.width/2-(t.y2-t.y1)/2,o=t.x2+t.width/2-(t.x2-t.x1)/2):(f=t.y2+t.width/2,o=t.x2+t.width/2),u.set({top:f,left:o,angle:t.angle}));i.setup.fabric.renderAll()}});i.setup.fabric.on("mouse:up",function(n){if(Number(new Date)-i.drawing.buffer.pressedTS<200){var t=i.setup.fabric.findTarget(n.e);t&&t.selectable&&i.setup.fabric.setActiveObject(t)}if(i.drawing.buffer.line){for(e=0;e<i.drawing.buffer.line.group.length;e++)i.drawing.buffer.line.group[e].remove();delete i.drawing.buffer.line.action;delete i.drawing.buffer.line.group;i.drawing.handler.line(i.drawing.buffer.line)}i.drawing.buffer.line=!1;i.drawing.buffer.hasLine=!1;i.drawing.buffer.isPressed=!1});i.setup.fabric.on("object:selected",function(n){i.drawing.buffer.isSelected=!0;i.drawing.buffer.target=n.target;i.setup.fabric.isDrawingMode=!1});i.setup.fabric.on("selection:cleared",function(){i.drawing.buffer.onMouseDown=i.setup.fabric.freeDrawingBrush.onMouseDown;i.drawing.buffer.target=!1;i.drawing.buffer.isSelected&&(i.setup.fabric._isCurrentlyDrawing=!1,i.setup.fabric.freeDrawingBrush.onMouseDown=function(){});setTimeout(function(){i.drawing.buffer.isSelected=!1;i.setup.fabric.isDrawingMode=!0;i.setup.fabric.freeDrawingBrush.onMouseDown=i.drawing.buffer.onMouseDown},10)});i.setup.fabric.on("path:created",function(n){var t=n.path;if(Number(new Date)-i.drawing.buffer.pressedTS<200||i.drawing.buffer.hasLine){i.setup.fabric.remove(t);i.setup.fabric.renderAll();return}});i.setup.fabric.on("object:added",function(n){var t=n.target,r=i.deepMerge(t.saveState().originalState,{cfg:{color:i.drawing.color,width:i.drawing.width,opacity:i.drawing.opacity,fontSize:i.drawing.fontSize}});if(Number(new Date)-i.drawing.buffer.pressedTS<200&&!t.noUndo){i.setup.fabric.remove(t);i.setup.fabric.renderAll();return}r=JSON.stringify(r);t.recentState=r;!t.selectable||t.known||t.noUndo||(t.isAnnotation=!0,i.drawing.undos.push({action:"added",target:t,state:r}),i.drawing.undos.push({action:"addified",target:t,state:r}),i.drawing.redos=[]);t.known=!0;i.setup.fabric.isDrawingMode=!0});i.setup.fabric.on("object:modified",function(n){var t=n.target,u=JSON.parse(t.recentState),r=i.deepMerge(t.saveState().originalState,{cfg:u.cfg});r=JSON.stringify(r);t.recentState=r;i.drawing.undos.push({action:"modified",target:t,state:r});i.drawing.redos=[]});i.setup.fabric.on("text:changed",function(n){var t=n.target;clearTimeout(t.timer);t.timer=setTimeout(function(){var n=JSON.stringify(t.saveState().originalState);t.recentState=n;i.drawing.redos=[];i.drawing.undos.push({action:"modified",target:t,state:n})},250)});for(i.drawing.enabled?(i.setup.wrapper.setAttribute("class",i.setup.chart.classNamePrefix+"-export-canvas active"),i.setup.wrapper.style.backgroundColor=f.backgroundColor,i.setup.wrapper.style.display="block"):(i.setup.wrapper.setAttribute("class",i.setup.chart.classNamePrefix+"-export-canvas"),i.setup.wrapper.style.display="none"),e=0;e<h.length;e++){var r=h[e],a=i.gatherClassName(r.parent,i.setup.chart.classNamePrefix+"-legend-div",1),s=i.gatherClassName(r.parent,i.setup.chart.classNamePrefix+"-stock-panel-div"),v=i.gatherClassName(r.parent,i.setup.chart.classNamePrefix+"-scrollbar-chart-div");i.setup.chart.type=="stock"&&i.setup.chart.legendSettings.position?["top","bottom"].indexOf(i.setup.chart.legendSettings.position)!=-1?r.parent.style.top&&r.parent.style.left?(r.offset.y=i.pxToNumber(r.parent.style.top),r.offset.x=i.pxToNumber(r.parent.style.left)):(r.offset.x=u.x,r.offset.y=u.y,u.y+=i.pxToNumber(r.parent.style.height),s?(u.pY=i.pxToNumber(s.style.marginTop),r.offset.y+=u.pY):v&&(r.offset.y+=u.pY)):["left","right"].indexOf(i.setup.chart.legendSettings.position)!=-1&&(r.offset.y=i.pxToNumber(r.parent.style.top)+u.pY,r.offset.x=i.pxToNumber(r.parent.style.left)+u.pX,a?u.pY+=i.pxToNumber(s.style.height)+i.setup.chart.panelsSettings.panelSpacing:v&&(r.offset.y-=i.setup.chart.panelsSettings.panelSpacing)):(r.parent.style.position=="absolute"?(r.offset.absolute=!0,r.offset.top=i.pxToNumber(r.parent.style.top),r.offset.right=i.pxToNumber(r.parent.style.right,!0),r.offset.bottom=i.pxToNumber(r.parent.style.bottom,!0),r.offset.left=i.pxToNumber(r.parent.style.left),r.offset.width=i.pxToNumber(r.parent.style.width),r.offset.height=i.pxToNumber(r.parent.style.height)):r.parent.style.top&&r.parent.style.left?(r.offset.y=i.pxToNumber(r.parent.style.top),r.offset.x=i.pxToNumber(r.parent.style.left)):r.legend?r.legend.position=="left"?u.x+=r.legend.width:r.legend.position=="right"?r.offset.x+=u.width-r.legend.width:r.legend.position=="top"?u.y+=r.legend.height:r.legend.position=="bottom"&&(r.offset.y+=u.height-r.legend.height):(r.offset.x=u.x,r.offset.y=u.y+u.pY,u.y+=i.pxToNumber(r.parent.style.height)),a&&s&&s.style.marginTop?(u.y+=i.pxToNumber(s.style.marginTop),r.offset.y+=i.pxToNumber(s.style.marginTop)):i.setup.chart.legend&&["left","right"].indexOf(i.setup.chart.legend.position)!=-1&&(r.offset.y=i.pxToNumber(r.parent.style.top),r.offset.x=i.pxToNumber(r.parent.style.left)));fabric.parseSVGDocument(r.svg,function(n){return function(r,e){var o,s=fabric.util.groupSVGElements(r,e),k=[],y={selectable:!1,isCoreElement:!0},a,b,p,g,nt;for(n.offset.absolute?(y.top=n.offset.bottom!==undefined?u.height-n.offset.height-n.offset.bottom:n.offset.top,y.left=n.offset.right!==undefined?u.width-n.offset.width-n.offset.right:n.offset.left):(y.top=n.offset.y,y.left=n.offset.x),o=0;o<s.paths.length;o++){if(a=null,s.paths[o]){if(i.removeImage(s.paths[o]["xlink:href"]))continue;s.paths[o].fill instanceof Object?s.paths[o].fill.type=="radial"&&["pie","gauge"].indexOf(i.setup.chart.type)==-1&&(s.paths[o].fill.coords.r2=s.paths[o].fill.coords.r1*-1,s.paths[o].fill.coords.r1=0,s.paths[o].set({opacity:s.paths[o].fillOpacity})):(a=i.isHashbanged(s.paths[o].fill))&&n.patterns&&n.patterns[a]&&(b=n.patterns[a],c.included++,fabric.Image.fromURL(b.source,function(n,t){return function(r){var u,f;c.loaded++;r.set({top:n.offsetY,left:n.offsetX,width:n.width,height:n.height});i.setup.fabric._isRetinaScaling()&&r.set({top:n.offsetY/2,left:n.offsetX/2,scaleX:.5,scaleY:.5});u=new fabric.StaticCanvas(undefined,{backgroundColor:n.fill,width:r.getWidth(),height:r.getHeight()});u.add(r);f=new fabric.Pattern({source:u.getElement(),offsetX:s.paths[t].width/2,offsetY:s.paths[t].height/2,repeat:"repeat"});s.paths[t].set({fill:f,opacity:s.paths[t].fillOpacity})}}(b,o)));(a=i.isHashbanged(s.paths[o].clipPath))&&n.clippings&&n.clippings[a]&&(function(t,i){var r=s.paths[t].toSVG;s.paths[t].toSVG=function(t){return r.apply(this,[function(r){return t(r,n.clippings[i])}])}}(o,a),s.paths[o].set({clipTo:function(t,r){return function(t){var u=n.clippings[r],e=this.transformMatrix||[1,0,0,1,0,0],f={top:u.bbox.y,left:u.bbox.x,width:u.bbox.width,height:u.bbox.height};i.setup.chart.type=="map"&&(f.top+=u.transform[5],f.left+=u.transform[4]);u.bbox.x&&e[4]&&u.bbox.y&&e[5]&&(f.top-=e[5],f.left-=e[4]);t.rect(f.left,f.top,f.width,f.height)}}(o,a)}))}k.push(s.paths[o])}if(s.paths=k,s.set(y),i.setup.fabric.add(s),n.svg.parentNode&&n.svg.parentNode.getElementsByTagName)for(p=n.svg.parentNode.getElementsByClassName(i.setup.chart.classNamePrefix+"-balloon-div"),o=0;o<p.length;o++)if(f.balloonFunction instanceof Function)f.balloonFunction.apply(i,[p[o],n]);else{var l=p[o],v=fabric.parseStyleAttribute(l),w=fabric.parseStyleAttribute(l.childNodes[0]),d=new fabric.Text(l.innerText||l.textContent||l.innerHTML,{selectable:!1,top:v.top+n.offset.y,left:v.left+n.offset.x,fill:w.color,fontSize:w.fontSize,fontFamily:w.fontFamily,textAlign:w["text-align"],isCoreElement:!0});i.setup.fabric.add(d)}if(n.svg.nextSibling&&n.svg.nextSibling.tagName=="A"){var l=n.svg.nextSibling,v=fabric.parseStyleAttribute(l),d=new fabric.Text(l.innerText||l.textContent||l.innerHTML,{selectable:!1,top:v.top+n.offset.y,left:v.left+n.offset.x,fill:v.color,fontSize:v.fontSize,fontFamily:v.fontFamily,opacity:v.opacity,isCoreElement:!0});i.setup.fabric.add(d)}h.pop();h.length||(g=Number(new Date),nt=setInterval(function(){var n=Number(new Date);(c.loaded==c.included||n-g>i.config.fabric.loadTimeout)&&(clearTimeout(nt),i.handleBorder(f),i.handleCallback(f.afterCapture,f),i.setup.fabric.renderAll(),i.handleCallback(t,f))},AmCharts.updateRate))}}(r),function(n,t){var r,s=i.gatherAttribute(n,"class"),c=i.gatherAttribute(n,"visibility"),l=i.gatherAttribute(n,"clip-path"),o;if(t.className=String(s),t.classList=String(s).split(" "),t.clipPath=l,t.svg=n,c=="hidden")t.opacity=0;else for(o=["fill","stroke"],r=0;r<o.length;r++){var u=o[r],a=String(n.getAttribute(u)||"none"),h=Number(n.getAttribute(u+"-opacity")||"1"),e=i.getRGBA(a);e&&(e.pop(),e.push(h),t[u]="rgba("+e.join()+")",t[u+i.capitalize("opacity")]=h)}i.handleCallback(f.reviver,t,n)})}},toCanvas:function(n,t){var u=i.deepMerge({},n||{}),r=i.setup.canvas;return i.handleCallback(t,r,u),r},toImage:function(n,t){var r=i.deepMerge({format:"png",quality:1,multiplier:i.config.multiplier},n||{}),f=r.data,u=document.createElement("img");return r.data||(f=r.lossless||r.format=="svg"?i.toSVG(i.deepMerge(r,{getBase64:!0})):i.setup.fabric.toDataURL(r)),u.setAttribute("src",f),i.handleCallback(t,u,r),u},toBlob:function(n,t){var r=i.deepMerge({data:"empty",type:"text/plain"},n||{}),u,f=/^data:.+;base64,(.*)$/.exec(r.data);return f&&(r.data=f[0],r.type=r.data.slice(5,r.data.indexOf(",")-7),r.data=i.toByteArray({data:r.data.slice(r.data.indexOf(",")+1,r.data.length)})),u=r.getByteArray?r.data:new Blob([r.data],{type:r.type}),i.handleCallback(t,u,r),u},toJPG:function(n,t){var r=i.deepMerge({format:"jpeg",quality:1,multiplier:i.config.multiplier},n||{}),u;return r.format=r.format.toLowerCase(),u=i.setup.fabric.toDataURL(r),i.handleCallback(t,u,r),u},toPNG:function(n,t){var r=i.deepMerge({format:"png",quality:1,multiplier:i.config.multiplier},n||{}),u=i.setup.fabric.toDataURL(r);return i.handleCallback(t,u,r),u},toSVG:function(n,t){var f=[],u=i.deepMerge({reviver:function(n,t){var y=new RegExp(/\bstyle=(['"])(.*?)\1/),c=y.exec(n)[0].slice(7,-1),r=c.split(";"),u=[],a,v,o,h;for(i1=0;i1<r.length;i1++)if(r[i1]){var l=r[i1].replace(/\s/g,"").split(":"),s=l[0],e=l[1];["fill","stroke"].indexOf(s)!=-1?(e=i.getRGBA(e,!0),e?(a="#"+e.toHex(),v=e._source[3],u.push([s,a].join(":")),u.push([s+"-opacity",v].join(":"))):u.push(r[i1])):s!="opactiy"&&u.push(r[i1])}if(n=n.replace(c,u.join(";")),t){o=2;h=n.slice(-o);h!="/>"&&(o=3,h=n.slice(-o));var p=n.slice(0,n.length-o),w=' clip-path="url(#'+t.svg.id+')" ',b=(new XMLSerializer).serializeToString(t.svg);n=p+w+h;f.push(b)}return n}},n||{}),r=i.setup.fabric.toSVG(u,u.reviver),e,o;return f.length&&(e=r.slice(0,r.length-6),o=r.slice(-6),r=e+f.join("")+o),u.getBase64&&(r="data:image/svg+xml;base64,"+btoa(r)),i.handleCallback(t,r,u),r},toPDF:function(n,t){function s(n){if(typeof n=="number"||n instanceof Number)n={left:n,right:n,top:n,bottom:n};else if(n instanceof Array)if(n.length===2)n={left:n[0],top:n[1],right:n[0],bottom:n[1]};else if(n.length===4)n={left:n[0],top:n[1],right:n[2],bottom:n[3]};else throw"Invalid pageMargins definition";else n={left:i.defaults.pdfMake.pageMargins,top:i.defaults.pdfMake.pageMargins,right:i.defaults.pdfMake.pageMargins,bottom:i.defaults.pdfMake.pageMargins};return n}function h(n,t){var r=i.defaults.pdfMake.pageSizes[String(n).toUpperCase()].slice();if(!r)throw new Error('The given pageSize "'+n+'" does not exist!');return t=="landscape"&&r.reverse(),r}var r=i.deepMerge(i.deepMerge({multiplier:i.config.multiplier||2,pageOrigin:i.config.pageOrigin===undefined?!0:!1},i.config.pdfMake),n||{},!0),o=new pdfMake.createPdf(r);if(r.images.reference=i.toPNG(r),!r.content){var u=[],f=h(r.pageSize,r.pageOrientation),e=s(r.pageMargins);f[0]-=e.left+e.right;f[1]-=e.top+e.bottom;r.pageOrigin&&(u.push(i.i18l("label.saved.from")),u.push(window.location.href),f[1]-=14.064*2);u.push({image:"reference",fit:f});r.content=u}return t&&o.getDataUrl(function(n){return function(){n.apply(i,arguments)}}(t)),o},toPRINT:function(n,t){var r,e=i.deepMerge({delay:1,lossless:!1},n||{}),f=i.toImage(e),o=[],u=document.body.childNodes;for(f.setAttribute("style","width: 100%; max-height: 100%;"),r=0;r<u.length;r++)i.isElement(u[r])&&(o[r]=u[r].style.display,u[r].style.display="none");return document.body.appendChild(f),window.print(),setTimeout(function(){for(r=0;r<u.length;r++)i.isElement(u[r])&&(u[r].style.display=o[r]);document.body.removeChild(f);i.handleCallback(t,f,e)},e.delay),f},toJSON:function(n,t){var r=i.deepMerge({dateFormat:i.config.dateFormat||"dateObject"},n||{},!0),u;return r.data=r.data?r.data:i.getChartData(r),u=JSON.stringify(r.data,undefined,"\t"),i.handleCallback(t,u,r),u},toCSV:function(n,t){function l(n){return typeof n=="string"&&(r.escape&&(n=n.replace('"','""')),r.quotes&&(n=['"',n,'"'].join(""))),n}var o,s,r=i.deepMerge({data:i.getChartData(n),delimiter:",",quotes:!0,escape:!0,withHeader:!0},n||{},!0),f="",h=[],u=[],c;for(var e in r.data[0])u.push(l(e)),h.push(e);r.withHeader&&(f+=u.join(r.delimiter)+"\n");for(o in r.data)if(u=[],!isNaN(o)){for(s in h)isNaN(s)||(c=h[s],e=r.data[o][c],u.push(l(e,c)));f+=u.join(r.delimiter)+"\n"}return i.handleCallback(t,f,r),f},toXLSX:function(n,t){function e(n,t){t&&(n+=1462);var i=Date.parse(n),r=n.getTimezoneOffset()*6e4;return(i-r-new Date(Date.UTC(1899,11,30)))/864e5}function o(n){for(var u,t,o,f={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},r=0;r!=n.length;++r)for(u=0;u!=n[r].length;++u)(i.s.r>r&&(i.s.r=r),i.s.c>u&&(i.s.c=u),i.e.r<r&&(i.e.r=r),i.e.c<u&&(i.e.c=u),t={v:n[r][u]},t.v!=null)&&(o=XLSX.utils.encode_cell({c:u,r:r}),typeof t.v=="number"?t.t="n":typeof t.v=="boolean"?t.t="b":t.v instanceof Date?(t.t="n",t.z=XLSX.SSF._table[14],t.v=e(t.v)):t.t="s",f[o]=t);return i.s.c<1e7&&(f["!ref"]=XLSX.utils.encode_range(i)),f}var r=i.deepMerge({name:"amCharts",dateFormat:i.config.dateFormat||"dateObject",withHeader:!0,stringify:!1},n||{},!0),u="",f={SheetNames:[],Sheets:{}};return r.data=r.data?r.data:i.getChartData(r),f.SheetNames.push(r.name),f.Sheets[r.name]=o(i.toArray(r)),u=XLSX.write(f,{bookType:"xlsx",bookSST:!0,type:"base64"}),u="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"+u,i.handleCallback(t,u,r),u},toArray:function(n,t){var s,u=i.deepMerge({data:i.getChartData(n),withHeader:!1,stringify:!0},n||{},!0),e=[],o=[],h,r,f;for(r in u.data[0])o.push(r);u.withHeader&&e.push(o);for(s in u.data)if(h=[],!isNaN(s)){for(r in o)isNaN(r)||(r=o[r],f=u.data[s][r],f=f==null?"":u.stringify?String(f):f,h.push(f));e.push(h)}return i.handleCallback(t,e,u),e},toByteArray:function(n,t){function r(n){var t=n.charCodeAt(0);return t===c?62:t===l?63:t<u?-1:t<u+10?t-u+26+26:t<o+26?t-o:t<e+26?t-e+26:void 0}function a(n){function u(n){e[l++]=n}var t,s,c,i,f,e,o,l;if(n.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");for(o=n.length,f="="===n.charAt(o-2)?2:"="===n.charAt(o-1)?1:0,e=new h(n.length*3/4-f),c=f>0?n.length-4:n.length,l=0,t=0,s=0;t<c;t+=4,s+=3)i=r(n.charAt(t))<<18|r(n.charAt(t+1))<<12|r(n.charAt(t+2))<<6|r(n.charAt(t+3)),u((i&16711680)>>16),u((i&65280)>>8),u(i&255);return f===2?(i=r(n.charAt(t))<<2|r(n.charAt(t+1))>>4,u(i&255)):f===1&&(i=r(n.charAt(t))<<10|r(n.charAt(t+1))<<4|r(n.charAt(t+2))>>2,u(i>>8&255),u(i&255)),e}var f=i.deepMerge({},n||{}),h=typeof Uint8Array!="undefined"?Uint8Array:Array,c="+".charCodeAt(0),l="/".charCodeAt(0),u="0".charCodeAt(0),e="a".charCodeAt(0),o="A".charCodeAt(0),s=a(f.data);return i.handleCallback(t,s,f),s},handleCallback:function(n){var t,r=Array();if(n&&n instanceof Function){for(t=0;t<arguments.length;t++)t>0&&r.push(arguments[t]);return n.apply(i,r)}},handleBorder:function(n){if(i.config.border instanceof Object){var t=i.deepMerge(i.defaults.fabric.border,n.border||{},!0),r=new fabric.Rect;t.width=i.setup.fabric.width-t.strokeWidth;t.height=i.setup.fabric.height-t.strokeWidth;r.set(t);i.setup.fabric.add(r)}},handleDropbox:function(n){var t,r;if(i.drawing.enabled)if(n.preventDefault(),n.stopPropagation(),n.type=="dragover")i.setup.wrapper.setAttribute("class",i.setup.chart.classNamePrefix+"-export-canvas active dropbox");else if(i.setup.wrapper.setAttribute("class",i.setup.chart.classNamePrefix+"-export-canvas active"),n.type=="drop"&&n.dataTransfer.files.length)for(t=0;t<n.dataTransfer.files.length;t++)r=new FileReader,r.onloadend=function(t){return function(){i.drawing.handler.add({url:r.result,top:n.layerY-t*10,left:n.layerX-t*10})}}(t),r.readAsDataURL(n.dataTransfer.files[t])},handleReady:function(n){var t=this,i=Number(new Date),r;t.handleCallback(n,"data",!1);for(filename in t.libs.namespaces)r=t.libs.namespaces[filename],function(r){var u=setInterval(function(){var f=Number(new Date);(f-i>t.libs.loadTimeout||r in window)&&(clearTimeout(u),t.handleCallback(n,r,f-i>t.libs.loadTimeout))},AmCharts.updateRate)}(r)},getChartData:function(n){function o(n,t,r){function f(n,t){return u.dataFields.indexOf(n)!=-1?f([n,".",t].join("")):n}n&&u.exportTitles&&i.setup.chart.type!="gantt"&&(e=f(n,r),u.dataFieldsMap[e]=n,u.dataFields.push(e),u.titles[e]=t||e)}var u=i.deepMerge({data:[],titles:{},dateFields:[],dataFields:[],dataFieldsMap:{},exportTitles:i.config.exportTitles,exportFields:i.config.exportFields,exportSelection:i.config.exportSelection,columnNames:i.config.columnNames},n||{},!0),r,t,s,h=["valueField","openField","closeField","highField","lowField","xField","yField"],y,c,e,a,l,f,v,p;if(u.data.length==0)if(i.setup.chart.type=="stock"){for(u.data=i.setup.chart.mainDataSet.dataProvider,o(i.setup.chart.mainDataSet.categoryField),u.dateFields.push(i.setup.chart.mainDataSet.categoryField),r=0;r<i.setup.chart.mainDataSet.fieldMappings.length;r++)for(c=i.setup.chart.mainDataSet.fieldMappings[r],t=0;t<i.setup.chart.panels.length;t++)for(y=i.setup.chart.panels[t],s=0;s<y.stockGraphs.length;s++)for(f=y.stockGraphs[s],i4=0;i4<h.length;i4++)f[h[i4]]==c.toField&&o(c.fromField,f.title,h[i4]);for(r=0;r<i.setup.chart.comparedGraphs.length;r++)for(f=i.setup.chart.comparedGraphs[r],t=0;t<f.dataSet.dataProvider.length;t++)for(s=0;s<f.dataSet.fieldMappings.length;s++)c=f.dataSet.fieldMappings[s],e=f.dataSet.id+"_"+c.toField,t<u.data.length&&(u.data[t][e]=f.dataSet.dataProvider[t][c.fromField],u.titles[e]||o(e,f.dataSet.title))}else if(i.setup.chart.type=="gantt"){for(o(i.setup.chart.categoryField),u.dateFields.push(i.setup.chart.categoryField),a=i.setup.chart.segmentsField,r=0;r<i.setup.chart.dataProvider.length;r++)if(l=i.setup.chart.dataProvider[r],l[a])for(t=0;t<l[a].length;t++)l[a][t][i.setup.chart.categoryField]=l[i.setup.chart.categoryField],u.data.push(l[a][t]);for(r=0;r<i.setup.chart.graphs.length;r++)for(f=i.setup.chart.graphs[r],t=0;t<h.length;t++){var v=h[t],p=f[v],w=f.title;o(p,f.title,v)}}else if(["pie","funnel"].indexOf(i.setup.chart.type)!=-1)u.data=i.setup.chart.dataProvider,o(i.setup.chart.titleField),u.dateFields.push(i.setup.chart.titleField),o(i.setup.chart.valueField);else if(i.setup.chart.type!="map")for(u.data=i.setup.chart.dataProvider,i.setup.chart.categoryAxis&&(o(i.setup.chart.categoryField,i.setup.chart.categoryAxis.title),i.setup.chart.categoryAxis.parseDates!==!1&&u.dateFields.push(i.setup.chart.categoryField)),r=0;r<i.setup.chart.graphs.length;r++)for(f=i.setup.chart.graphs[r],t=0;t<h.length;t++)v=h[t],p=f[v],o(p,f.title,v);return i.processData(u)},getAnnotations:function(n,t){for(var e=i.deepMerge({},n||{},!0),u=[],f,r=0;r<i.setup.fabric._objects.length;r++)i.setup.fabric._objects[r].isCoreElement||(f=i.setup.fabric._objects[r].toJSON(),i.handleCallback(e.reviver,f,r),u.push(f));return i.handleCallback(t,u),u},setAnnotations:function(n,t){var r=i.deepMerge({data:[]},n||{},!0);return fabric.util.enlivenObjects(r.data,function(n){n.forEach(function(n,t){i.handleCallback(r.reviver,n,t);i.setup.fabric.add(n)});i.handleCallback(t,r)}),r.data},processData:function(t){var r=i.deepMerge({data:[],titles:{},dateFields:[],dataFields:[],dataFieldsMap:{},dataDateFormat:i.setup.chart.dataDateFormat,dateFormat:i.config.dateFormat||i.setup.chart.dataDateFormat||"YYYY-MM-DD",exportTitles:i.config.exportTitles,exportFields:i.config.exportFields,exportSelection:i.config.exportSelection,columnNames:i.config.columnNames,processData:i.config.processData},t||{},!0),f,e,c,s,h;if(r.data.length){for(f=0;f<r.data.length;f++)for(e in r.data[f])r.dataFields.indexOf(e)==-1&&(r.dataFields.push(e),r.dataFieldsMap[e]=e);for(r.exportFields!==undefined&&(r.dataFields=r.dataFields.filter(function(n){return r.exportFields.indexOf(n)!=-1})),c=[],f=0;f<r.data.length;f++){for(s={},h=!1,e=0;e<r.dataFields.length;e++){var o=r.dataFields[e],a=r.dataFieldsMap[o],l=r.columnNames&&r.columnNames[o]||r.titles[o]||o,u=r.data[f][a];u==null&&(u=undefined);r.exportTitles&&i.setup.chart.type!="gantt"&&l in s&&(l+=["( ",o," )"].join(""));r.dateFields.indexOf(a)!=-1&&(r.dataDateFormat&&(u instanceof String||typeof u=="string")?u=AmCharts.stringToDate(u,r.dataDateFormat):r.dateFormat&&(u instanceof Number||typeof u=="number")&&(u=new Date(u)),r.exportSelection&&(u instanceof Date?(u<n.startDate||u>n.endDate)&&(h=!0):(f<n.startIndex||f>n.endIndex)&&(h=!0)),r.dateFormat&&r.dateFormat!="dateObject"&&u instanceof Date&&(u=AmCharts.formatDate(u,r.dateFormat)));s[l]=u}h||c.push(s)}r.data=c}return r.processData!==undefined&&(r.data=i.handleCallback(r.processData,r.data,r)),r.data},capitalize:function(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()},createMenu:function(t,r){function u(t,r){for(var o,v=document.createElement("ul"),c,s,e,b,k,a=0;a<t.length;a++){var f=typeof t[a]=="string"?{format:t[a]}:t[a],h=document.createElement("li"),l=document.createElement("a"),p=document.createElement("img"),y=document.createElement("span"),w=String(f.action?f.action:f.format).toLowerCase();if(f.format=String(f.format).toUpperCase(),i.config.formats[f.format]?f=i.deepMerge({label:f.icon?"":f.format,format:f.format,mimeType:i.config.formats[f.format].mimeType,extension:i.config.formats[f.format].extension,capture:i.config.formats[f.format].capture,action:i.config.action,fileName:i.config.fileName},f):f.label||(f.label=f.label?f.label:i.i18l("menu.label."+w)),["CSV","JSON","XLSX"].indexOf(f.format)!=-1&&["map","gauge"].indexOf(i.setup.chart.type)!=-1)continue;else if(!i.setup.hasBlob&&f.format!="UNDEFINED"&&f.mimeType&&f.mimeType.split("/")[0]!="image"&&f.mimeType!="text/plain")continue;if(f.action=="draw")i.config.fabric.drawing.enabled?(f.menu=f.menu?f.menu:i.config.fabric.drawing.menu,f.click=function(n){return function(){this.capture(n,function(){this.createMenu(n.menu)})}}(f)):f.menu=[];else if(!f.populated&&f.action&&f.action.indexOf("draw.")!=-1)for(c=f.action.split(".")[1],s=f[c]||i.config.fabric.drawing[c]||[],f.menu=[],f.populated=!0,o=0;o<s.length;o++)e={label:s[o]},c=="shapes"?(b=s[o].indexOf("//")==-1,k=(b?i.config.path+"shapes/":"")+s[o],e.action="add",e.url=k,e.icon=k,e.ignore=b,e["class"]="export-drawing-shape"):c=="colors"?(e.style="background-color: "+s[o],e.action="change",e.color=s[o],e["class"]="export-drawing-color"):c=="widths"?(e.action="change",e.width=s[o],e.label=document.createElement("span"),e.label.style.width=i.numberToPx(s[o]),e.label.style.height=i.numberToPx(s[o]),e["class"]="export-drawing-width"):c=="opacities"?(e.style="opacity: "+s[o],e.action="change",e.opacity=s[o],e.label=s[o]*100+"%",e["class"]="export-drawing-opacity"):c=="modes"&&(e.label=i.i18l("menu.label.draw.modes."+s[o]),e.click=function(n){return function(){i.drawing.mode=n}}(s[o]),e["class"]="export-drawing-mode"),f.menu.push(e);else f.click||f.menu||f.items||(i.drawing.handler[w]instanceof Function?(f.action=w,f.click=function(n){return function(){this.drawing.handler[n.action](n)}}(f)):i.drawing.enabled?f.click=function(n){return function(){this.config.drawing.autoClose&&this.drawing.handler.done();this["to"+n.format](n,function(t){n.action=="download"&&this.download(t,n.mimeType,[n.fileName,n.extension].join("."))})}}(f):f.format!="UNDEFINED"&&(f.click=function(n){return function(){if(n.capture||n.action=="print"||n.format=="PRINT")this.capture(n,function(){this.config.drawing.autoClose&&this.drawing.handler.done();this["to"+n.format](n,function(t){n.action=="download"&&this.download(t,n.mimeType,[n.fileName,n.extension].join("."))})});else if(this["to"+n.format])this["to"+n.format](n,function(t){this.download(t,n.mimeType,[n.fileName,n.extension].join("."))});else throw new Error("Invalid format. Could not determine output type.");}}(f)));(f.menu===undefined||f.menu.length)&&(l.setAttribute("href","#"),l.addEventListener("click",function(n,t){return function(r){r.preventDefault();var u=[r,t];if((t.action=="draw"||t.format=="PRINT"||t.format!="UNDEFINED"&&t.capture)&&!i.drawing.enabled&&(t.delay=t.delay?t.delay:i.config.delay,t.delay)){i.delay(t,n);return}n.apply(i,u)}}(f.click||function(n){n.preventDefault()},f)),h.appendChild(l),i.isElement(f.label)?y.appendChild(f.label):y.innerHTML=f.label,f["class"]&&(h.className=f["class"]),f.style&&h.setAttribute("style",f.style),f.icon&&(p.setAttribute("src",(!f.ignore&&f.icon.slice(0,10).indexOf("//")==-1?n.pathToImages:"")+f.icon),l.appendChild(p)),f.label&&l.appendChild(y),f.title&&l.setAttribute("title",f.title),i.config.menuReviver&&(h=i.config.menuReviver.apply(i,[f,h])),f.elements={li:h,a:l,img:p,span:y},(f.menu||f.items)&&f.action!="draw"?u(f.menu||f.items,h).childNodes.length&&v.appendChild(h):v.appendChild(h))}return v.childNodes.length&&r.appendChild(v),v}return r||(typeof i.config.divId=="string"?i.config.divId=r=document.getElementById(i.config.divId):r=i.isElement(i.config.divId)?i.config.divId:i.setup.chart.containerDiv),i.isElement(i.setup.menu)?i.setup.menu.innerHTML="":i.setup.menu=document.createElement("div"),i.setup.menu.setAttribute("class",i.setup.chart.classNamePrefix+"-export-menu "+i.setup.chart.classNamePrefix+"-export-menu-"+i.config.position+" amExportButton"),i.config.menuWalker&&(u=i.config.menuWalker),u.apply(this,[t,i.setup.menu]),i.setup.menu.childNodes.length&&r.appendChild(i.setup.menu),i.setup.menu},delay:function(n,t){var r=i.deepMerge({delay:3,precision:2},n||{}),u,f,o=Number(new Date),s=i.createMenu([{label:i.i18l("capturing.delayed.menu.label").replace("{{duration}}",AmCharts.toFixed(r.delay,r.precision)),title:i.i18l("capturing.delayed.menu.title"),"class":"export-delayed-capturing",click:function(){clearTimeout(u);clearTimeout(f);i.createMenu(i.config.menu)}}]),e=s.getElementsByTagName("a")[0];u=setInterval(function(){var n=r.delay-(Number(new Date)-o)/1e3;n<=0?(clearTimeout(u),r.action!="draw"&&i.createMenu(i.config.menu)):e&&(e.innerHTML=i.i18l("capturing.delayed.menu.label").replace("{{duration}}",AmCharts.toFixed(n,2)))},AmCharts.updateRate);f=setTimeout(function(){t.apply(i,arguments)},r.delay*1e3)},migrateSetup:function(n){function i(n){var r,u;for(r in n)u=n[r],r.slice(0,6)=="export"&&u?t.menu.push(r.slice(6)):r=="userCFG"?i(u):r=="menuItems"?t.menu=u:r=="libs"?t.libs=u:typeof r=="string"&&(t[r]=u)}var t={enabled:!0,migrated:!0,libs:{autoLoad:!0},menu:[]};return i(n),t},clear:function(){var n,t,r;if(i.setup=undefined,i.docListener&&document.removeEventListener("keydown",i.docListener),n=i.listenersToRemove,n)for(t=0;t<n.length;t++)r=n[t],r.node.removeEventListener(r.event,r.method);i.listenersToRemove=[]},loadListeners:function(){function n(n){n&&(n.set({top:n.top+10,left:n.left+10}),i.setup.fabric.add(n))}i.config.keyListener&&i.config.keyListener!="attached"&&(i.docListener=function(t){var r=i.drawing.buffer.target;(t.keyCode==8||t.keyCode==46)&&r?(t.preventDefault(),i.setup.fabric.remove(r)):t.keyCode==27&&i.drawing.enabled?(t.preventDefault(),i.drawing.handler.done()):t.keyCode==67&&(t.metaKey||t.ctrlKey)&&r?i.drawing.buffer.copy=r:t.keyCode==88&&(t.metaKey||t.ctrlKey)&&r?(i.drawing.buffer.copy=r,i.setup.fabric.remove(r)):t.keyCode==86&&(t.metaKey||t.ctrlKey)?i.drawing.buffer.copy&&n(i.drawing.buffer.copy.clone(n)):t.keyCode==90&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),t.shiftKey?i.drawing.handler.redo():i.drawing.handler.undo())},i.config.keyListener="attached",document.addEventListener("keydown",i.docListener));i.config.fileListener&&(i.setup.chart.containerDiv.addEventListener("dragover",i.handleDropbox),i.setup.chart.containerDiv.addEventListener("dragleave",i.handleDropbox),i.setup.chart.containerDiv.addEventListener("drop",i.handleDropbox))},init:function(){clearTimeout(i.timer);i.timer=setInterval(function(){i.setup.chart.containerDiv&&(clearTimeout(i.timer),i.config.enabled&&(i.setup.chart.AmExport=i,i.config.overflow&&(i.setup.chart.div.style.overflow="visible"),i.loadListeners(),i.createMenu(i.config.menu),i.handleReady(i.config.onReady)))},AmCharts.updateRate)},construct:function(){i.drawing.handler.cancel=i.drawing.handler.done;try{i.setup.hasBlob=!!new Blob}catch(n){}window.safari=window.safari?window.safari:{};i.defaults.fabric.drawing.fontSize=i.setup.chart.fontSize||11;i.config.drawing=i.deepMerge(i.defaults.fabric.drawing,i.config.drawing||{},!0);i.config.border&&(i.config.border=i.deepMerge(i.defaults.fabric.border,i.config.border||{},!0));i.deepMerge(i.defaults.fabric,i.config,!0);i.deepMerge(i.defaults.fabric,i.config.fabric||{},!0);i.deepMerge(i.defaults.pdfMake,i.config,!0);i.deepMerge(i.defaults.pdfMake,i.config.pdfMake||{},!0);i.deepMerge(i.libs,i.config.libs||{},!0);i.config.drawing=i.defaults.fabric.drawing;i.config.fabric=i.defaults.fabric;i.config.pdfMake=i.defaults.pdfMake;i.config=i.deepMerge(i.defaults,i.config,!0);i.config.fabric.drawing.enabled&&i.config.fabric.drawing.menu===undefined&&(i.config.fabric.drawing.menu=[],i.deepMerge(i.config.fabric.drawing.menu,[{"class":"export-drawing",menu:[{label:i.i18l("menu.label.draw.add"),menu:[{label:i.i18l("menu.label.draw.shapes"),action:"draw.shapes"},{label:i.i18l("menu.label.draw.text"),action:"text"}]},{label:i.i18l("menu.label.draw.change"),menu:[{label:i.i18l("menu.label.draw.modes"),action:"draw.modes"},{label:i.i18l("menu.label.draw.colors"),action:"draw.colors"},{label:i.i18l("menu.label.draw.widths"),action:"draw.widths"},{label:i.i18l("menu.label.draw.opacities"),action:"draw.opacities"},"UNDO","REDO"]},{label:i.i18l("menu.label.save.image"),menu:["PNG","JPG","SVG","PDF"]},"PRINT","CANCEL"]}]));i.config.menu===undefined&&(i.config.menu=[],i.deepMerge(i.config,{menu:[{"class":"export-main",menu:[{label:i.i18l("menu.label.save.image"),menu:["PNG","JPG","SVG","PDF"]},{label:i.i18l("menu.label.save.data"),menu:["CSV","XLSX","JSON"]},{label:i.i18l("menu.label.draw"),action:"draw",menu:i.config.fabric.drawing.menu},{format:"PRINT",label:i.i18l("menu.label.print")}]}]}));i.libs.path||(i.libs.path=i.config.path+"libs/");i.isSupported()&&(i.loadDependencies(i.libs.resources,i.libs.reload),i.setup.chart.addClassNames=!0,i.setup.chart[i.name]=i,i.init())}};if(t)i.config=t;else if(i.setup.chart[i.name])i.config=i.setup.chart[i.name];else if(i.setup.chart.amExport||i.setup.chart.exportConfig)i.config=i.migrateSetup(i.setup.chart.amExport||i.setup.chart.exportConfig);else return;return i.construct(),i.deepMerge(this,i)}}();AmCharts.addInitHandler(function(n){new AmCharts["export"](n)},["pie","serial","xy","funnel","radar","gauge","stock","map","gantt"]);
//# sourceMappingURL=export.min.js.map
